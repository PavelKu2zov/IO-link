//**************************************************************************************************
// @Module        DL_MODE_HANDLER
// @Filename      DL_ModeHandler.c
//--------------------------------------------------------------------------------------------------
// @Platform      PLATFORM_NAME
//--------------------------------------------------------------------------------------------------
// @Compatible    COMPATIBLE_PROCESSOR_MODULE
//--------------------------------------------------------------------------------------------------
// @Description   Implementation of the DL_MODE_HANDLER functionality.
//                
//
//                Abbreviations:
//                  DL - Data link layer
//                  
//
//                Global (public) functions:
//                  MODULE_functionZero()
//                  MODULE_functionOne()
//
//                Local (private) functions:
//                  MODULE_functionTwo()
//                  MODULE_functionThree()
//
//--------------------------------------------------------------------------------------------------
// @Version       1.0.0
//--------------------------------------------------------------------------------------------------
// @Date          XX.XX.XXXX
//--------------------------------------------------------------------------------------------------
// @History       Version  Author      Comment
// XX.XX.XXXX     1.0.0    XXX         First release.
//**************************************************************************************************



//**************************************************************************************************
// Project Includes
//**************************************************************************************************

// Native header
#include "DL_ModeHandler_drv.h"
#include "FreeRTOS.h"
#include "task.h"
#include "main.h"



//**************************************************************************************************
// Verification of the imported configuration parameters
//**************************************************************************************************

//None.

//**************************************************************************************************
// Definitions of global (public) variables
//**************************************************************************************************

//None.



//**************************************************************************************************
// Declarations of local (private) data types
//**************************************************************************************************


// Вынести во внешний заголовочны файл(общий)
typedef enum DL_MODE_Mode_enum
{
    DL_MODE_INACTIVE=0,
    DL_MODE_STARTUP,
    DL_MODE_PREOPERATE,
    DL_MODE_OPERATE
}DL_MODE_Mode;


// State machine of DL mode handler
typedef enum DL_MODE_TypeStateMachine_enum
{
    DL_MODE_Idle_0=0,
    DL_MODE_WURQ_5,
    DL_MODE_ComRequestCOM3_6,
    DL_MODE_ComRequestCOM2_7,
    DL_MODE_ComRequestCOM1_8,
    DL_MODE_Retry_9,
    DL_MODE_Startup_2,
    DL_MODE_PreOperate_3,
    DL_MODE_Operate_4
}DL_MODE_TypeStateMachine;



//**************************************************************************************************
// Definitions of local (private) constants
//**************************************************************************************************

// None.


//**************************************************************************************************
// Definitions of static global (private) variables
//**************************************************************************************************

DL_MODE_TypeStateMachine DL_MODE_StateMachine;

DL_MODE_Mode DL_MODE_CurrentMode;

DL_MODE_Mode DL_MODE_NextMode;


//**************************************************************************************************
// Declarations of local (private) functions
//**************************************************************************************************

// None.


//**************************************************************************************************
//==================================================================================================
// Definitions of global (public) functions
//==================================================================================================
//**************************************************************************************************



//**************************************************************************************************
// @Function      DL_MODE_Task()
//--------------------------------------------------------------------------------------------------
// @Description   task of DL mode handler
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    None.
//**************************************************************************************************
void DL_MODE_Task(void *pvParameters)
{
	for(;;)
	{
		//Wait Semaphore from SM
		xSemaphoreTake( xDL_SetMode, portMAX_DELAY );
		
        //Get next mode
        DL_MODE_NextMode =  DL_MODE_GetNextMode();
        
        // move in state machine
        switch(DL_MODE_StateMachine)
        {
            case DL_MODE_Idle_0:
                {
                    if (DL_MODE_STARTUP == DL_MODE_NextMode)
                    {
                        DL_MODE_EstablishCom();
                        
                    }
                }
                break;
        }
		
	}
}// end of DL_MODE_Task()



//**************************************************************************************************
// @Function      MODULE_FunctionOne()
//--------------------------------------------------------------------------------------------------
// @Description   [description...]
//--------------------------------------------------------------------------------------------------
// @Notes
//--------------------------------------------------------------------------------------------------
// @ReturnValue   returnValue - [description...]
//--------------------------------------------------------------------------------------------------
// @Parameters    parameterZero - [description...]
//                parameterOne  - [description...]
//**************************************************************************************************
DATA_TYPE MODULE_FunctionOne(DATA_TYPE parameterZero,
                             DATA_TYPE parameterOne)
{
    DATA_TYPE returnValue;
    
    // [Description...]
    DATA_TYPE idx = 0;
    for ( ; idx < MAX; idx++)
    {
        arrayResult[idx] = arrayInitial[idx];
    }
    
    return returnValue;
    
} // end of MODULE_FunctionOne()



//**************************************************************************************************
//==================================================================================================
// Definitions of local (private) functions
//==================================================================================================
//**************************************************************************************************



//**************************************************************************************************
// @Function      DL_MODE_EstablishCom()
//--------------------------------------------------------------------------------------------------
// @Description   [description...]
//--------------------------------------------------------------------------------------------------
// @Notes
//--------------------------------------------------------------------------------------------------
// @ReturnValue   returnValue - [description...]
//--------------------------------------------------------------------------------------------------
// @Parameters    parameterZero - [description...]
//                parameterOne  - [description...]
//**************************************************************************************************
static void DL_MODE_EstablishCom(void)
{
    // Wake Up request to PL
    DL_MODE_WURQ(void);    
    
} // end of DL_MODE_EstablishCom()



//**************************************************************************************************
// @Function      MODULE_FunctionThree()
//--------------------------------------------------------------------------------------------------
// @Description   [description...]
//--------------------------------------------------------------------------------------------------
// @Notes
//--------------------------------------------------------------------------------------------------
// @ReturnValue   returnValue - [description...]
//--------------------------------------------------------------------------------------------------
// @Parameters    parameterZero - [description...]
//                parameterOne  - [description...]
//                parameterTwo  - [description...]
//**************************************************************************************************
static DATA_TYPE MODULE_FunctionThree(DATA_TYPE parameterZero,
                                      DATA_TYPE parameterOne,
                                      DATA_TYPE parameterTwo)
{
    DATA_TYPE returnValue;
    
    // [Place code here]
    
    return returnValue;
    
} // end of MODULE_FunctionThree()



//****************************************** end of file *******************************************

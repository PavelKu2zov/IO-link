//**************************************************************************************************
// @Module        DL_MES_HANDLER
// @Filename      DL_MessageHandler.c
//--------------------------------------------------------------------------------------------------
// @Platform      stm32f103
//--------------------------------------------------------------------------------------------------
// @Compatible    
//--------------------------------------------------------------------------------------------------
// @Description   Implementation of the DL Message Handler functionality.
//
//
//                Abbreviations:
//                  DL - Data link layer
//
//
//                 Global (public) functions:
//
//
//
//                Local (private) functions:
//
//
//
//--------------------------------------------------------------------------------------------------
// @Version       1.0.0
//--------------------------------------------------------------------------------------------------
// @Date          30.08.2021
//--------------------------------------------------------------------------------------------------
// @History       Version  Author      Comment
// XX.XX.XXXX     1.0.0    KPS         First release.
//**************************************************************************************************



//**************************************************************************************************
// Project Includes
//**************************************************************************************************

// Native header
#include "DL_MessageHandler_drv.h"
#include "FreeRTOS.h"
#include "task.h"
#include "main.h"


//**************************************************************************************************
// Verification of the imported configuration parameters
//**************************************************************************************************

// None.


//**************************************************************************************************
// Definitions of global (public) variables
//**************************************************************************************************

// None.


//**************************************************************************************************
// Declarations of local (private) data types
//**************************************************************************************************

typedef enum DL_MES_TypeStateMachine_enum
{
    DL_MES_Inactive_0=0,
    DL_MES_AwaitReply_1,
    DL_MES_Startup_2,
    DL_MES_Response_3,
    DL_MES_Preoperate_6,
    DL_MES_GetOD_7,
    DL_MES_Response_8,
    DL_MES_Operate_12,
    DL_MES_GetPD_13
}DL_MES_TypeStateMachine;


//**************************************************************************************************
// Definitions of local (private) constants
//**************************************************************************************************

// None.
              
//**************************************************************************************************
// Definitions of static global (private) variables
//**************************************************************************************************

static DL_MES_TypeStateMachine DL_MES_StateMachine; 


//**************************************************************************************************
// Declarations of local (private) functions
//**************************************************************************************************

// None.


//**************************************************************************************************
//==================================================================================================
// Definitions of global (public) functions
//==================================================================================================
//**************************************************************************************************

//**************************************************************************************************
// @Function      DL_MES_Init()
//--------------------------------------------------------------------------------------------------
// @Description   Init DL Message handler
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    None.
//**************************************************************************************************
void DL_MES_Init(void)
{
    TIM_DeInit(DL_Timer);
	TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStruct;
    TIM_TimeBaseInitStruct.TIM_Period = DL_MES_TIMER_PERIOD;
	TIM_TimeBaseInitStruct.TIM_Prescaler = PL_TIMER_PRESCALER;
	TIM_TimeBaseInitStruct.TIM_ClockDivision = TIM_CKD_DIV1;
	TIM_TimeBaseInitStruct.TIM_CounterMode = TIM_CounterMode_Up;
	TIM_TimeBaseInitStruct.TIM_RepetitionCounter = 0x0000;
	TIM_TimeBaseInit(DL_MES_Timer, &TIM_TimeBaseInitStruct);
	
    DL_MES_StateMachine = DL_MES_Inactive_0;
    
}// end of DL_MES_Init()



//**************************************************************************************************
// @Function      DL_MES_Task()
//--------------------------------------------------------------------------------------------------
// @Description   task of Data link layer
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    None.
//**************************************************************************************************
void DL_MES_Task(void *pvParameters)
{
	for(;;)
	{
		//Wait SemaphorePL
		xSemaphoreTake( xSemaphorePL, portMAX_DELAY );
		
		
	}
}// end of DL_MES_Task()



//**************************************************************************************************
//==================================================================================================
// Definitions of local (private) functions
//==================================================================================================
//**************************************************************************************************

//**************************************************************************************************
// @Function      
//--------------------------------------------------------------------------------------------------
// @Description   The PL-WakeUp service initiates or indicates a specific sequence which prepares 
//			      the Physical Layer to send and receive communication requests.
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    None.
//**************************************************************************************************
void ( void )
{
		GPIO_WriteBit(PL_PORT_IO_LINK, PL_PIN_TRANSMMITER, Bit_RESET);
	}
}
// end of ()



//**************************************************************************************************
// @Function      
//--------------------------------------------------------------------------------------------------
// @Description   SetMode service is used to setup the electrical characteristics and configurations 
//				  of the Physical Layer.
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    mode - INACTIVE,DI,DO,COM1,COM2,COM3
//**************************************************************************************************
void ( );
{

	
}
// end of ()


//**************************************************************************************************
// @Function      
//--------------------------------------------------------------------------------------------------
// @Description   The PL-Transfer service is used to exchange the SDCI data between Data Link Layer 
//				  and  Physical Layer
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    None.
//**************************************************************************************************
void ( void )
{
	
}
// end of ()



//**************************************************************************************************
// @Function      PL_Delay
//--------------------------------------------------------------------------------------------------
// @Description   Delay for PL. It bases on PL_TIMER
//--------------------------------------------------------------------------------------------------
// @Notes         None.
//--------------------------------------------------------------------------------------------------
// @ReturnValue   None.
//--------------------------------------------------------------------------------------------------
// @Parameters    time in us
//**************************************************************************************************
void PL_Delay( uint16_t time )
{
	TIM_Cmd(PL_Timer, DISABLE);
	TIM_ClearFlag(PL_Timer, TIM_FLAG_Update);
	TIM_SetAutoreload(PL_TIMER, time*PL_K);
	//wait
	TIM_Cmd(PL_Timer, ENABLE);
	while(RESET != TIM_GetFlagStatus(PL_Timer, TIM_FLAG_Update));
	TIM_Cmd(PL_Timer, DISABLE);
}
// end of PL_Delay()




//****************************************** end of file *******************************************
